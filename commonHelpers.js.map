{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport default function fetchingGallery() {\n  let nextPageNumber = 1;\n  const hitsPerPage = 16;\n\n  async function fetchingGalleryPage(userRequest) {\n    const searchParams = new URLSearchParams({\n      key: '44842729-8004d444f82c9829d0058eeb4',\n      q: userRequest,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page: nextPageNumber,\n      per_page: hitsPerPage,\n    });\n\n    const response = await axios.get(\n      `https://pixabay.com/api/?${searchParams}`\n    );\n\n    nextPageNumber++;\n\n    const { hits, totalHits } = response.data;\n\n    return { hits, totalHits, nextPageNumber };\n  }\n\n  function resetNextPageNum() {\n    nextPageNumber = 1;\n  }\n\n  return { fetchingGalleryPage, resetNextPageNum, hitsPerPage };\n}\n","export default function renderGallery(requestedHits, galleryNode) {\n  let markup = '';\n\n  requestedHits.forEach(\n    ({\n      webformatURL,\n      largeImageURL,\n      tags,\n      likes,\n      views,\n      comments,\n      downloads,\n    }) => {\n      markup += `<li class=\"gallery-item\">\n  <a class=\"gallery-item__link\" href=\"${largeImageURL}\">\n  <img\n  src=\"${webformatURL}\"\n  alt=\"${tags}\"\n  /></a>\n  <ul class=\"image-descr\">\n  <li>\n    <span>Likes</span>\n    <span>${likes}</span>\n  </li>\n  <li>\n    <span>Views</span>\n    <span>${views}</span>\n  </li>\n  <li>\n    <span>Comments</span>\n    <span>${comments}</span>\n  </li>\n  <li>\n    <span>Downloads</span>\n    <span>${downloads}</span>\n  </li>\n</ul>\n</li>`;\n    }\n  );\n\n  galleryNode.insertAdjacentHTML('beforeend', markup);\n}\n","// Описаний у документації\nimport iziToast from 'izitoast';\n// Додатковий імпорт стилів\nimport 'izitoast/dist/css/iziToast.min.css';\n// Описаний у документації\nimport SimpleLightbox from 'simplelightbox';\n// Додатковий імпорт стилів\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport fetchingGallery from './js/pixabay-api';\nimport renderGallery from './js/render-functions';\n\nconst searchForm = document.querySelector('.search-form');\nconst galleryList = document.querySelector('.gallery');\nconst loadMoreBtn = document.querySelector('button[data-load]');\n\nconst { fetchingGalleryPage, resetNextPageNum, hitsPerPage } =\n  fetchingGallery();\nlet userRequest = '';\n\nconst galleryLightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nsearchForm.addEventListener('submit', async event => {\n  event.preventDefault();\n\n  userRequest = event.target.elements.requestValue.value.trim();\n\n  if (!userRequest) {\n    return;\n  }\n\n  resetNextPageNum();\n  clearGallery();\n  showLoader(searchForm);\n  hideLoadMoreBtn();\n\n  try {\n    const { hits: firstPage } = await fetchingGalleryPage(userRequest);\n\n    if (!firstPage.length) {\n      iziToast.error({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight',\n      });\n\n      removeLoader();\n\n      return;\n    }\n\n    setTimeout(() => {\n      renderGallery(firstPage, galleryList);\n      galleryLightbox.refresh();\n\n      removeLoader();\n      showLoadMoreBtn();\n    }, 1000);\n  } catch (error) {\n    console.error(error);\n\n    iziToast.error({\n      message: 'Ooops! Something went wrong. Try again later',\n      position: 'topRight',\n    });\n\n    removeLoader();\n  }\n\n  searchForm.reset();\n});\n\nloadMoreBtn.addEventListener('click', async () => {\n  showLoader(galleryList);\n  hideLoadMoreBtn();\n\n  try {\n    const {\n      hits: nextPage,\n      totalHits,\n      nextPageNumber,\n    } = await fetchingGalleryPage(userRequest);\n\n    const currentPage = nextPageNumber - 1;\n    const totalPages = Math.ceil(totalHits / hitsPerPage);\n\n    if (currentPage > totalPages) {\n      iziToast.error({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n      removeLoader();\n\n      return;\n    }\n\n    const { height: itemHeight } = document\n      .querySelector('.gallery-item')\n      .getBoundingClientRect();\n\n    setTimeout(() => {\n      removeLoader();\n\n      renderGallery(nextPage, galleryList);\n      galleryLightbox.refresh();\n\n      showLoadMoreBtn();\n      window.scrollBy(0, itemHeight * 2);\n    }, 500);\n  } catch (error) {\n    console.error(error);\n\n    iziToast.error({\n      message: 'Ooops! Something went wrong. Try again later',\n      position: 'topRight',\n    });\n\n    removeLoader();\n  }\n});\n\nfunction showLoader(leftNeighborNode) {\n  leftNeighborNode.insertAdjacentHTML(\n    'afterend',\n    `<span class='loader'></span>`\n  );\n}\n\nfunction removeLoader(loaderNode = document.querySelector('.loader')) {\n  if (loaderNode) {\n    loaderNode.remove();\n  }\n}\n\nfunction showLoadMoreBtn() {\n  if (loadMoreBtn.classList.contains('visually-hidden')) {\n    loadMoreBtn.classList.remove('visually-hidden');\n  }\n}\n\nfunction hideLoadMoreBtn() {\n  loadMoreBtn.classList.add('visually-hidden');\n}\n\nfunction clearGallery() {\n  galleryList.innerHTML = '';\n}\n"],"names":["fetchingGallery","nextPageNumber","hitsPerPage","fetchingGalleryPage","userRequest","searchParams","response","axios","hits","totalHits","resetNextPageNum","renderGallery","requestedHits","galleryNode","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","searchForm","galleryList","loadMoreBtn","galleryLightbox","SimpleLightbox","event","clearGallery","showLoader","hideLoadMoreBtn","firstPage","iziToast","removeLoader","showLoadMoreBtn","error","nextPage","currentPage","totalPages","itemHeight","leftNeighborNode","loaderNode"],"mappings":"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"}